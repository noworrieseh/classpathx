# 
# Copyright (C) 2003 Julian Scheid
# 
# This file is part of GNU LibxmlJ, a JAXP-compliant Java wrapper for
# the XML and XSLT C libraries for Gnome (libxml2/libxslt).
# 
# GNU LibxmlJ is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the
# Free Software Foundation; either version 2, or (at your option) any
# later version.
#  
# GNU LibxmlJ is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with GNU LibxmlJ; see the file COPYING.  If not, write to the
# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
# 02111-1307 USA. 
#

lib_LTLIBRARIES = libxmlj.la

libxmlj_la_DEPENDENCIES = \
  org/w3c/dom/Attr.class \
  org/w3c/dom/CDATASection.class \
  org/w3c/dom/CharacterData.class \
  org/w3c/dom/Comment.class \
  org/w3c/dom/DOMException.class \
  org/w3c/dom/DOMImplementation.class \
  org/w3c/dom/Document.class \
  org/w3c/dom/DocumentFragment.class \
  org/w3c/dom/DocumentType.class \
  org/w3c/dom/Element.class \
  org/w3c/dom/Entity.class \
  org/w3c/dom/EntityReference.class \
  org/w3c/dom/NamedNodeMap.class \
  org/w3c/dom/Node.class \
  org/w3c/dom/NodeList.class \
  org/w3c/dom/Notation.class \
  org/w3c/dom/ProcessingInstruction.class \
  org/w3c/dom/Text.class \
  org/w3c/dom/css/CSS2Azimuth.class \
  org/w3c/dom/css/CSS2BackgroundPosition.class \
  org/w3c/dom/css/CSS2BorderSpacing.class \
  org/w3c/dom/css/CSS2CounterIncrement.class \
  org/w3c/dom/css/CSS2CounterReset.class \
  org/w3c/dom/css/CSS2Cursor.class \
  org/w3c/dom/css/CSS2FontFaceSrc.class \
  org/w3c/dom/css/CSS2FontFaceWidths.class \
  org/w3c/dom/css/CSS2PageSize.class \
  org/w3c/dom/css/CSS2PlayDuring.class \
  org/w3c/dom/css/CSS2Properties.class \
  org/w3c/dom/css/CSS2TextShadow.class \
  org/w3c/dom/css/CSSCharsetRule.class \
  org/w3c/dom/css/CSSFontFaceRule.class \
  org/w3c/dom/css/CSSImportRule.class \
  org/w3c/dom/css/CSSMediaRule.class \
  org/w3c/dom/css/CSSPageRule.class \
  org/w3c/dom/css/CSSPrimitiveValue.class \
  org/w3c/dom/css/CSSRule.class \
  org/w3c/dom/css/CSSRuleList.class \
  org/w3c/dom/css/CSSStyleDeclaration.class \
  org/w3c/dom/css/CSSStyleRule.class \
  org/w3c/dom/css/CSSStyleSheet.class \
  org/w3c/dom/css/CSSUnknownRule.class \
  org/w3c/dom/css/CSSValue.class \
  org/w3c/dom/css/CSSValueList.class \
  org/w3c/dom/css/Counter.class \
  org/w3c/dom/css/DOMImplementationCSS.class \
  org/w3c/dom/css/DocumentCSS.class \
  org/w3c/dom/css/ElementCSSInlineStyle.class \
  org/w3c/dom/css/RGBColor.class \
  org/w3c/dom/css/Rect.class \
  org/w3c/dom/css/ViewCSS.class \
  org/w3c/dom/events/DocumentEvent.class \
  org/w3c/dom/events/Event.class \
  org/w3c/dom/events/EventException.class \
  org/w3c/dom/events/EventListener.class \
  org/w3c/dom/events/EventTarget.class \
  org/w3c/dom/events/MouseEvent.class \
  org/w3c/dom/events/MutationEvent.class \
  org/w3c/dom/events/UIEvent.class \
  org/w3c/dom/html/HTMLAnchorElement.class \
  org/w3c/dom/html/HTMLAppletElement.class \
  org/w3c/dom/html/HTMLAreaElement.class \
  org/w3c/dom/html/HTMLBRElement.class \
  org/w3c/dom/html/HTMLBaseElement.class \
  org/w3c/dom/html/HTMLBaseFontElement.class \
  org/w3c/dom/html/HTMLBodyElement.class \
  org/w3c/dom/html/HTMLButtonElement.class \
  org/w3c/dom/html/HTMLCollection.class \
  org/w3c/dom/html/HTMLDListElement.class \
  org/w3c/dom/html/HTMLDOMImplementation.class \
  org/w3c/dom/html/HTMLDirectoryElement.class \
  org/w3c/dom/html/HTMLDivElement.class \
  org/w3c/dom/html/HTMLDocument.class \
  org/w3c/dom/html/HTMLElement.class \
  org/w3c/dom/html/HTMLFieldSetElement.class \
  org/w3c/dom/html/HTMLFontElement.class \
  org/w3c/dom/html/HTMLFormElement.class \
  org/w3c/dom/html/HTMLFrameElement.class \
  org/w3c/dom/html/HTMLFrameSetElement.class \
  org/w3c/dom/html/HTMLHRElement.class \
  org/w3c/dom/html/HTMLHeadElement.class \
  org/w3c/dom/html/HTMLHeadingElement.class \
  org/w3c/dom/html/HTMLHtmlElement.class \
  org/w3c/dom/html/HTMLIFrameElement.class \
  org/w3c/dom/html/HTMLImageElement.class \
  org/w3c/dom/html/HTMLInputElement.class \
  org/w3c/dom/html/HTMLIsIndexElement.class \
  org/w3c/dom/html/HTMLLIElement.class \
  org/w3c/dom/html/HTMLLabelElement.class \
  org/w3c/dom/html/HTMLLegendElement.class \
  org/w3c/dom/html/HTMLLinkElement.class \
  org/w3c/dom/html/HTMLMapElement.class \
  org/w3c/dom/html/HTMLMenuElement.class \
  org/w3c/dom/html/HTMLMetaElement.class \
  org/w3c/dom/html/HTMLModElement.class \
  org/w3c/dom/html/HTMLOListElement.class \
  org/w3c/dom/html/HTMLObjectElement.class \
  org/w3c/dom/html/HTMLOptGroupElement.class \
  org/w3c/dom/html/HTMLOptionElement.class \
  org/w3c/dom/html/HTMLParagraphElement.class \
  org/w3c/dom/html/HTMLParamElement.class \
  org/w3c/dom/html/HTMLPreElement.class \
  org/w3c/dom/html/HTMLQuoteElement.class \
  org/w3c/dom/html/HTMLScriptElement.class \
  org/w3c/dom/html/HTMLSelectElement.class \
  org/w3c/dom/html/HTMLStyleElement.class \
  org/w3c/dom/html/HTMLTableCaptionElement.class \
  org/w3c/dom/html/HTMLTableCellElement.class \
  org/w3c/dom/html/HTMLTableColElement.class \
  org/w3c/dom/html/HTMLTableElement.class \
  org/w3c/dom/html/HTMLTableRowElement.class \
  org/w3c/dom/html/HTMLTableSectionElement.class \
  org/w3c/dom/html/HTMLTextAreaElement.class \
  org/w3c/dom/html/HTMLTitleElement.class \
  org/w3c/dom/html/HTMLUListElement.class \
  org/w3c/dom/ranges/DocumentRange.class \
  org/w3c/dom/ranges/Range.class \
  org/w3c/dom/ranges/RangeException.class \
  org/w3c/dom/stylesheets/DocumentStyle.class \
  org/w3c/dom/stylesheets/LinkStyle.class \
  org/w3c/dom/stylesheets/MediaList.class \
  org/w3c/dom/stylesheets/StyleSheet.class \
  org/w3c/dom/stylesheets/StyleSheetList.class \
  org/w3c/dom/traversal/DocumentTraversal.class \
  org/w3c/dom/traversal/NodeFilter.class \
  org/w3c/dom/traversal/NodeIterator.class \
  org/w3c/dom/traversal/TreeWalker.class \
  org/w3c/dom/views/AbstractView.class \
  org/w3c/dom/views/DocumentView.class \
  org/xml/sax/AttributeList.class \
  org/xml/sax/Attributes.class \
  org/xml/sax/ContentHandler.class \
  org/xml/sax/DTDHandler.class \
  org/xml/sax/DocumentHandler.class \
  org/xml/sax/EntityResolver.class \
  org/xml/sax/ErrorHandler.class \
  org/xml/sax/HandlerBase.class \
  org/xml/sax/InputSource.class \
  org/xml/sax/Locator.class \
  org/xml/sax/Parser.class \
  org/xml/sax/SAXException.class \
  org/xml/sax/SAXNotRecognizedException.class \
  org/xml/sax/SAXNotSupportedException.class \
  org/xml/sax/SAXParseException.class \
  org/xml/sax/XMLFilter.class \
  org/xml/sax/XMLReader.class \
  org/xml/sax/ext/Attributes2.class \
  org/xml/sax/ext/Attributes2Impl.class \
  org/xml/sax/ext/DeclHandler.class \
  org/xml/sax/ext/DefaultHandler2.class \
  org/xml/sax/ext/EntityResolver2.class \
  org/xml/sax/ext/LexicalHandler.class \
  org/xml/sax/ext/Locator2.class \
  org/xml/sax/ext/Locator2Impl.class \
  org/xml/sax/helpers/AttributeListImpl.class \
  org/xml/sax/helpers/AttributesImpl.class \
  org/xml/sax/helpers/DefaultHandler.class \
  org/xml/sax/helpers/LocatorImpl.class \
  org/xml/sax/helpers/NamespaceSupport.class \
  org/xml/sax/helpers/NewInstance.class \
  org/xml/sax/helpers/ParserAdapter.class \
  org/xml/sax/helpers/ParserFactory.class \
  org/xml/sax/helpers/XMLFilterImpl.class \
  org/xml/sax/helpers/XMLReaderAdapter.class \
  org/xml/sax/helpers/XMLReaderFactory.class \
  javax/xml/parsers/ClassStuff.class \
  javax/xml/parsers/DocumentBuilder.class \
  javax/xml/parsers/DocumentBuilderFactory.class \
  javax/xml/parsers/FactoryConfigurationError.class \
  javax/xml/parsers/ParserConfigurationException.class \
  javax/xml/parsers/SAXParser.class \
  javax/xml/parsers/SAXParserFactory.class \
  javax/xml/transform/ClassStuff.class \
  javax/xml/transform/ErrorListener.class \
  javax/xml/transform/OutputKeys.class \
  javax/xml/transform/Result.class \
  javax/xml/transform/Source.class \
  javax/xml/transform/SourceLocator.class \
  javax/xml/transform/Templates.class \
  javax/xml/transform/Transformer.class \
  javax/xml/transform/TransformerConfigurationException.class \
  javax/xml/transform/TransformerException.class \
  javax/xml/transform/TransformerFactory.class \
  javax/xml/transform/TransformerFactoryConfigurationError.class \
  javax/xml/transform/URIResolver.class \
  javax/xml/transform/dom/DOMLocator.class \
  javax/xml/transform/dom/DOMResult.class \
  javax/xml/transform/dom/DOMSource.class \
  javax/xml/transform/sax/SAXResult.class \
  javax/xml/transform/sax/SAXSource.class \
  javax/xml/transform/sax/SAXTransformerFactory.class \
  javax/xml/transform/sax/TemplatesHandler.class \
  javax/xml/transform/sax/TransformerHandler.class \
  javax/xml/transform/stream/StreamResult.class \
  javax/xml/transform/stream/StreamSource.class \
	gnu/xml/aelfred2/JAXPFactory.class \
  gnu/xml/aelfred2/SAXDriver.class \
  gnu/xml/aelfred2/XmlParser.class \
  gnu/xml/aelfred2/XmlReader.class \
  gnu/xml/dom/Consumer.class \
  gnu/xml/dom/DomAttr.class \
  gnu/xml/dom/DomCDATA.class \
  gnu/xml/dom/DomCharacterData.class \
  gnu/xml/dom/DomComment.class \
  gnu/xml/dom/DomDoctype.class \
  gnu/xml/dom/DomDocument.class \
  gnu/xml/dom/DomElement.class \
  gnu/xml/dom/DomEntity.class \
  gnu/xml/dom/DomEntityReference.class \
  gnu/xml/dom/DomEvent.class \
  gnu/xml/dom/DomEx.class \
  gnu/xml/dom/DomExtern.class \
  gnu/xml/dom/DomFragment.class \
  gnu/xml/dom/DomImpl.class \
  gnu/xml/dom/DomIterator.class \
  gnu/xml/dom/DomNamedNodeMap.class \
  gnu/xml/dom/DomNode.class \
  gnu/xml/dom/DomNotation.class \
  gnu/xml/dom/DomNsNode.class \
  gnu/xml/dom/DomPI.class \
  gnu/xml/dom/DomText.class \
  gnu/xml/dom/JAXPFactory.class \
  gnu/xml/pipeline/CallFilter.class \
  gnu/xml/pipeline/DomConsumer.class \
  gnu/xml/pipeline/EventConsumer.class \
  gnu/xml/pipeline/EventFilter.class \
  gnu/xml/pipeline/LinkFilter.class \
  gnu/xml/pipeline/NSFilter.class \
  gnu/xml/pipeline/PipelineFactory.class \
  gnu/xml/pipeline/TeeConsumer.class \
  gnu/xml/pipeline/TextConsumer.class \
  gnu/xml/pipeline/ValidationConsumer.class \
  gnu/xml/pipeline/WellFormednessFilter.class \
  gnu/xml/pipeline/XIncludeFilter.class \
  gnu/xml/pipeline/XsltFilter.class \
  gnu/xml/util/DoParse.class \
  gnu/xml/util/DomParser.class \
  gnu/xml/util/Resolver.class \
  gnu/xml/util/SAXNullTransformerFactory.class \
  gnu/xml/util/XCat.class \
  gnu/xml/util/XHTMLWriter.class \
  gnu/xml/util/XMLWriter.class \
  gnu/xml/libxmlj/transform/DefaultErrorListenerImpl.class \
  gnu/xml/libxmlj/transform/DefaultURIResolverImpl.class \
  gnu/xml/libxmlj/transform/ErrorListenerProxy.class \
  gnu/xml/libxmlj/transform/IOToolkit.class \
  gnu/xml/libxmlj/transform/JavaContext.class \
  gnu/xml/libxmlj/transform/LibxmlDocument.class \
  gnu/xml/libxmlj/transform/LibxsltStylesheet.class \
  gnu/xml/libxmlj/transform/SourceLocatorImpl.class \
  gnu/xml/libxmlj/transform/SourceWrapper.class \
  gnu/xml/libxmlj/transform/TemplatesImpl.class \
  gnu/xml/libxmlj/transform/TransformTest.class \
  gnu/xml/libxmlj/transform/TransformerFactoryImpl.class \
  gnu/xml/libxmlj/transform/TransformerImpl.class \
  gnu/xml/libxmlj/transform/URIResolverProxy.class \
	javax_xml_transform_OutputKeys.h \
	gnu_xml_libxmlj_transform_LibxsltStylesheet.h \
	gnu_xml_libxmlj_transform_TransformerFactoryImpl.h \
	gnu_xml_libxmlj_transform_JavaContext.h \
	gnu_xml_libxmlj_transform_LibxmlDocument.h

libxmlj_la_SOURCES = src/libxsltj.c src/xmlj_io.c src/xmlj_error.c
libxmlj_la_LDFLAGS = -release 0.1.2 -export-dynamic
libxmlj_la_CFLAGS = -pedantic -Wall -fbounds-check

JARFILE = gnujaxp.jar
data_DATA = ${JARFILE}

BUILT_SOURCES = ${libxmlj_la_DEPENDENCIES} ${JARFILE}

# Generate header files for classes containing native code.
# I did remove the -force argument (not available in gcjh nor in kaffe)
gnu_xml_libxmlj_transform_%.h: 
	@JAVAH@ -jni -classpath . gnu.xml.libxmlj.transform.$*

javax_xml_transform_%.h:
	@JAVAH@ -jni javax.xml.transform.$*

## Rule for compiling Java source files
##gnu/xml/aelfred2/%.class: @srcdir@/src/gnu/xml/aelfred2/%.java
##	echo "Compiling $*.java..."
##	@JAVAC@ @JAVACFLAGS@ \
##		-d . \
##		-classpath "${CLASSPATH}:@srcdir@/src:." $<
##
##gnu/xml/dom/%.class: @srcdir@/src/gnu/xml/dom/%.java
##	echo "Compiling $*.java..."
##	@JAVAC@ @JAVACFLAGS@ \
##		-d . \
##		-classpath "${CLASSPATH}:@srcdir@/src:." $<
##
##	@srcdir@/src/gnu/xml/util/%.java \
##		@srcdir@/src/gnu/xml/pipeline/%.java \
##		@srcdir@/src/gnu/xml/libxmlj/transform/%.java \
##		@srcdir@/src/org/w3c/dom/css/%.java \
##		@srcdir@/src/org/w3c/dom/events/%.java \
##		@srcdir@/src/org/w3c/dom/html/%.java \
##		@srcdir@/src/org/w3c/dom/ranges/%.java \
##		@srcdir@/src/org/w3c/dom/stylesheets/%.java \
##		@srcdir@/src/org/w3c/dom/traversal/%.java \
##		@srcdir@/src/org/w3c/dom/views/%.java \
##		@srcdir@/src/org/xml/sax/ext/%.java \
##		@srcdir@/src/org/xml/sax/helpers/%.java \
##		@srcdir@/src/javax/xml/transform/dom/%.java \
##		@srcdir@/src/javax/xml/transform/sax/%.java \
##		@srcdir@/src/javax/xml/transform/stream/%.java
##
##
##		@srcdir@/src/javax/xml/parsers/%.java \
##		@srcdir@/src/javax/xml/transform/%.java \
# Rule for compiling Java source files
org/%.class: @srcdir@/src/org/%.java
	@JAVAC@ @JAVACFLAGS@ -d . -classpath "${CLASSPATH}:@srcdir@/src:." $<

javax/%.class: @srcdir@/src/javax/%.java
	@JAVAC@ @JAVACFLAGS@ -d . -classpath "${CLASSPATH}:@srcdir@/src:." $<

gnu/%.class: @srcdir@/src/gnu/%.java
	@JAVAC@ @JAVACFLAGS@ -d . -classpath "${CLASSPATH}:@srcdir@/src:." $<

# Jar file

${JARFILE}: gnu javax org
	@JAR@ cfm ${JARFILE} manifest.mf $^

# Remove classes and jar file

clean-local:
	rm -f ${JARFILE}
	rm -rf gnu javax org
	rm -f *.h *.o

# Run a simple transformation to check that the package is working

check-local: gnu/xml/libxmlj/transform/TransformTest.class
	@JAVA@  -classpath "${CLASSPATH}:${JARFILE}:." -Djava.library.path=.libs gnu.xml.libxmlj.transform.TransformTest @srcdir@/testdocs/test.xml @srcdir@/testdocs/testsheet.xsl transformed.xml
	diff @srcdir@/testdocs/transformed.xml transformed.xml

dist-hook:
	mkdir $(distdir)/src/gnu
	cp -r $(srcdir)/src/gnu/* $(distdir)/src/gnu
	mkdir $(distdir)/testdocs
	cp $(srcdir)/testdocs/* $(distdir)/testdocs

